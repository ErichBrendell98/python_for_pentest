"""
Criação de um Servidor Multiprocessos

Processos: São independentes, ou seja, executam em espaços diferentes da memória.

Usado para se trabalhar com um grandes volumes de dados e de processamento;
Consome mais memória;
Processos filhos são fáceis de serem interrompidos;
"""

import socket, sys
from multiprocessing import Process

def clientHandler(clientSocket):
    isConnected = True
    while isConnected:
        data = clientSocket.recv(1024)
        if data:
            clientSocket.send(data)
        else:
            clientSocket.close()
            isConnected = False

server = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
server.bind(('', int(sys.argv[1])))
server.listen(10)
while True:
    clientSocket, addr = server.accept()
    clientIP, clientPort = addr
    print(f'New client connected from {clientIP}:{clientPort}')
    Process(target=clientHandler, args=(clientSocket,)).start()